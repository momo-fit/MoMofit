<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.zerock.momofit.mapper.chat.GroupChatMapper">

    <resultMap id="GroupChatVO" type="org.zerock.momofit.domain.chat.GroupChatVO">
        <result column="group_no" property="group_no"/>
        <result column="group_name" property="group_name"/>
        <result column="sports" property="sports"/>
        <result column="group_loc" property="group_loc"/>
        <result column="member_max" property="member_max"/>
        <result column="schedule" property="schedule"/>
        <result column="info" property="info"/>
        <result column="user_no" property="user_no"/>
        <result column="group_img" property="group_img"/>
        <result column="path" property="path"/>
        <result column="temp" property="temp"/>
        
        
        <collection 
                    property="list"
                    resultMap="GroupMemberVO">
        </collection>
        
    </resultMap>

    <resultMap id="GroupMemberVO" type="org.zerock.momofit.domain.chat.GroupMemberVO">
    	<result column="group_no" property="group_no"/>
        <result column="group_member_no" property="group_member_no"/>
        <result column="group_user_no" property="group_user_no"/>
        <result column="join_date" property="join_date"/>
        <result column="nickname" property="nickname"/>
    </resultMap>
    
    <!-- 참여한, 그룹정보와 멤버들 구하기 -->
    <select id="selectGroupInfoWithMembers" resultMap="GroupChatVO">
    	SELECT 
		    t1.group_no,
		    t1.group_name,
		    t1.sports,
		    t1.group_loc,
		    t1.member_max,
		    t1.schedule,
		    t1.info,
		    t1.user_no,
		    t1.group_img,
		    t1.path,
		    t1.temp,
		    t2.group_no,
		    t2.group_member_no,
		    t2.user_no AS group_user_no,
		    t2.join_date,
		    t3.nickname
		FROM groups t1
		
		INNER JOIN group_member t2
		ON t1.group_no = t2.group_no
		
		INNER JOIN users t3
		ON t2.user_no = t3.user_no
		
		WHERE t1.group_no = #{group_no}
    </select>

    <!-- user_no로 나의 그룹 리스트 얻기 -->
    <select id="selectMyGroupList" resultType="org.zerock.momofit.domain.chat.GroupChatVO">
        SELECT /*+ LEADING(t1 t2) USE_NL(t2) index_desc(t1 pk_group_member) */
            t2.group_no,
            t2.group_name
        FROM
            group_member t1
        INNER JOIN groups t2
        ON t1.group_no = t2.group_no
        WHERE t1.user_no = #{user_no}
    </select>


</mapper>