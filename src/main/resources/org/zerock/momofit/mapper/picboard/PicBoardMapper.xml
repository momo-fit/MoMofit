<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.zerock.momofit.mapper.picboard.PicBoardMapper">


    <select id="selectAllList" resultType="org.zerock.momofit.domain.picboard.PicBoardVO">
        SELECT /*+ index_desc(board) */ * FROM board WHERE CATEGORY_NO=3
    </select>
    
    <!-- 작성하기 -->
    <insert id="insert">
        INSERT INTO BOARD(board_no,title, text, board_like, hits, img_check, user_no, category_no)
        VALUES(BOARD_SEQ.nextval,#{title}, #{text}, #{board_like},#{hits}, #{img_check}, #{user_no},#{category_no} )
    </insert>
    
    <insert id="insertSelectKey">
    	<selectKey keyProperty="board_no" order="BEFORE" resultType="int">
            SELECT  BOARD_SEQ.nextval FROM dual
        </selectKey>

        INSERT INTO BOARD(board_no, title, text, board_like, hits, img_check, user_no, category_no)
        VALUES( #{board_no},#{title}, #{text}, #{board_like}, #{hits}, #{img_check}, #{user_no},#{category_no} )
    
    </insert>
    
    <!-- 삭제하기 -->
    <delete id="delete">
    
    DELETE FROM board WHERE board_no=#{board_no}
    
    </delete>
    
    <!-- 수정하기 -->
    <update id="update">
        UPDATE board
        SET
            title=#{title},
            text=#{text},
            edit=current_date
        WHERE
            board_no=#{board_no}
    </update>

    <!-- 상세조회하기 -->
    <select id="select" resultType="org.zerock.momofit.domain.picboard.PicBoardVO">
        SELECT * FROM board WHERE board_no=#{board_no}
    </select>
    
    <!-- 페이징처리가 가능한 목록 조회  -->
    <select 
        id="selectListWithPaging" 
        resultType="org.zerock.momofit.domain.picboard.PicBoardVO">

       	SELECT /*+ index_desc(board)*/ *
        FROM board
        WHERE CATEGORY_NO=3
        OFFSET (#{currPage}-1)*#{amount} ROWS
        FETCH NEXT #{amount} ROWS ONLY

    </select>
    

    <!-- 총 게시글의 갯수를 반환  -->
    <select 
        id="getTotalCount"
        resultType="int">

        SELECT /*+ index(board) */ count(board_no)
        FROM board
        WHERE CATEGORY_NO=3

    </select>
    
    <!-- 게시글 클릭할때마다, 조회수 올리기  -->
    <update 
        id="plusHits">

        UPDATE board SET hits = hits +1 WHERE board_no =#{board_no}

    </update>


    
    
    
    
    
    
    
</mapper> 